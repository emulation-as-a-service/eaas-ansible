{% if docker_ssl_enabled %}
frontend=*,443
{% else %}
frontend=*,80;no-tls
{% endif %}

{% set eaas_endpoints = [
			'blobstore',
			'eaas',
			'emil',
			'emucomp',
			'environment-proposer',
			'imagearchive',
			'imagebuilder',
			'imageclassifier',
			'imageproposer',
			'oaipmh',
			'objectarchive',
			'softwarearchive'
] %}
{% for endpoint in eaas_endpoints %}
backend=127.0.0.1,8080;/{{endpoint}}/
{% endfor %}

backend=nginx,80;

{% if keycloak_enabled %}
backend=keycloak,8080;/auth/
{% endif %}
backend-no-tls=yes
workers=1

{% if docker_ssl_enabled %}
private-key-file=/etc/nghttpx/server.key
certificate-file=/etc/nghttpx/server.crt
{% endif %}

frontend-http2-read-timeout=120m
frontend-read-timeout=120m
backend-read-timeout=120m
add-x-forwarded-for=yes

